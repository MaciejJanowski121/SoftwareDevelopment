{"ast":null,"code":"var _jsxFileName = \"/Users/maciejjanowski/Desktop/reservationSystem/frontend/src/components/Validation.jsx\",\n  _s = $RefreshSig$();\n// src/components/Validation.jsx\nimport React, { useEffect, useState } from \"react\";\n\n/**\n * Schützt Kinder-Komponenten durch einen einfachen Auth-Check.\n *\n * <p>Verhalten:</p>\n * <ul>\n *   <li>Ruft <code>/auth/auth_check</code> mit <code>credentials: \"include\"</code> auf.</li>\n *   <li>Bei Erfolg: setzt <code>authorized=true</code> und extrahiert <code>email</code>, <code>role</code>.</li>\n *   <li>Reicht diese Props per <code>React.cloneElement</code> an das Kind weiter.</li>\n *   <li>Optional: Fallback aus <code>localStorage</code> (Key: <code>authUser</code>) mit Feldern <code>email</code>, <code>role</code>.</li>\n * </ul>\n *\n * <p><strong>Hinweise:</strong></p>\n * <ul>\n *   <li>Das Backend liefert <code>AuthUserDTO</code> (&rarr; Felder: <code>email</code>, <code>role</code>, <code>fullName</code>, <code>phone</code>).</li>\n *   <li>Dieses HOC erwartet genau ein Kind (ein einzelnes React-Element).</li>\n * </ul>\n *\n * @param {{ children: React.ReactElement }} props\n */\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nexport default function Validation({\n  children\n}) {\n  _s();\n  const [isLoading, setIsLoading] = useState(true);\n  const [authorized, setAuthorized] = useState(false);\n  const [email, setEmail] = useState(\"\");\n  const [role, setRole] = useState(\"\");\n  useEffect(() => {\n    const ac = new AbortController();\n    const checkAuth = async () => {\n      try {\n        const res = await fetch(\"http://localhost:8080/auth/auth_check\", {\n          method: \"GET\",\n          credentials: \"include\",\n          signal: ac.signal\n        });\n        if (res.ok) {\n          const data = await res.json();\n          // Backend: AuthUserDTO -> { email, role, fullName, phone }\n          setEmail(data.email || \"\");\n          setRole(data.role || \"\");\n          setAuthorized(true);\n        } else {\n          setAuthorized(false);\n        }\n      } catch {\n        setAuthorized(false);\n      } finally {\n        setIsLoading(false);\n      }\n    };\n    checkAuth();\n    return () => ac.abort();\n  }, []);\n  if (isLoading) {\n    return /*#__PURE__*/_jsxDEV(\"p\", {\n      \"aria-live\": \"polite\",\n      children: \"Authentifizierung wird \\xFCberpr\\xFCft\\u2026\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 67,\n      columnNumber: 16\n    }, this);\n  }\n\n  // Optionaler Fallback: Werte aus localStorage, falls vorhanden\n  // Erwartetes Schema: { \"email\": \"...\", \"role\": \"ROLE_...\" }\n  const localUser = (() => {\n    try {\n      return JSON.parse(localStorage.getItem(\"authUser\") || \"{}\");\n    } catch {\n      return {};\n    }\n  })();\n  if (authorized && email) {\n    return /*#__PURE__*/React.cloneElement(children, {\n      email,\n      role\n    });\n  }\n  if (localUser !== null && localUser !== void 0 && localUser.email) {\n    return /*#__PURE__*/React.cloneElement(children, {\n      email: localUser.email,\n      role: localUser.role\n    });\n  }\n  return null;\n}\n_s(Validation, \"gY0clqZ0nr0Ps92Yt+WJKp3TGVY=\");\n_c = Validation;\nvar _c;\n$RefreshReg$(_c, \"Validation\");","map":{"version":3,"names":["React","useEffect","useState","jsxDEV","_jsxDEV","Validation","children","_s","isLoading","setIsLoading","authorized","setAuthorized","email","setEmail","role","setRole","ac","AbortController","checkAuth","res","fetch","method","credentials","signal","ok","data","json","abort","fileName","_jsxFileName","lineNumber","columnNumber","localUser","JSON","parse","localStorage","getItem","cloneElement","_c","$RefreshReg$"],"sources":["/Users/maciejjanowski/Desktop/reservationSystem/frontend/src/components/Validation.jsx"],"sourcesContent":["// src/components/Validation.jsx\nimport React, { useEffect, useState } from \"react\";\n\n/**\n * Schützt Kinder-Komponenten durch einen einfachen Auth-Check.\n *\n * <p>Verhalten:</p>\n * <ul>\n *   <li>Ruft <code>/auth/auth_check</code> mit <code>credentials: \"include\"</code> auf.</li>\n *   <li>Bei Erfolg: setzt <code>authorized=true</code> und extrahiert <code>email</code>, <code>role</code>.</li>\n *   <li>Reicht diese Props per <code>React.cloneElement</code> an das Kind weiter.</li>\n *   <li>Optional: Fallback aus <code>localStorage</code> (Key: <code>authUser</code>) mit Feldern <code>email</code>, <code>role</code>.</li>\n * </ul>\n *\n * <p><strong>Hinweise:</strong></p>\n * <ul>\n *   <li>Das Backend liefert <code>AuthUserDTO</code> (&rarr; Felder: <code>email</code>, <code>role</code>, <code>fullName</code>, <code>phone</code>).</li>\n *   <li>Dieses HOC erwartet genau ein Kind (ein einzelnes React-Element).</li>\n * </ul>\n *\n * @param {{ children: React.ReactElement }} props\n */\nexport default function Validation({ children }) {\n\n    const [isLoading, setIsLoading] = useState(true);\n    const [authorized, setAuthorized] = useState(false);\n\n\n    const [email, setEmail] = useState(\"\");\n    const [role, setRole] = useState(\"\");\n\n    useEffect(() => {\n\n        const ac = new AbortController();\n\n        const checkAuth = async () => {\n            try {\n                const res = await fetch(\"http://localhost:8080/auth/auth_check\", {\n                    method: \"GET\",\n                    credentials: \"include\",\n                    signal: ac.signal,\n                });\n\n                if (res.ok) {\n                    const data = await res.json();\n                    // Backend: AuthUserDTO -> { email, role, fullName, phone }\n                    setEmail(data.email || \"\");\n                    setRole(data.role || \"\");\n                    setAuthorized(true);\n                } else {\n                    setAuthorized(false);\n                }\n            } catch {\n\n                setAuthorized(false);\n            } finally {\n                setIsLoading(false);\n            }\n        };\n\n        checkAuth();\n        return () => ac.abort();\n    }, []);\n\n\n    if (isLoading) {\n        return <p aria-live=\"polite\">Authentifizierung wird überprüft…</p>;\n    }\n\n    // Optionaler Fallback: Werte aus localStorage, falls vorhanden\n    // Erwartetes Schema: { \"email\": \"...\", \"role\": \"ROLE_...\" }\n    const localUser = (() => {\n        try {\n            return JSON.parse(localStorage.getItem(\"authUser\") || \"{}\");\n        } catch {\n            return {};\n        }\n    })();\n\n\n    if (authorized && email) {\n        return React.cloneElement(children, { email, role });\n    }\n\n\n    if (localUser?.email) {\n        return React.cloneElement(children, {\n            email: localUser.email,\n            role: localUser.role,\n        });\n    }\n\n\n    return null;\n}"],"mappings":";;AAAA;AACA,OAAOA,KAAK,IAAIC,SAAS,EAAEC,QAAQ,QAAQ,OAAO;;AAElD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAlBA,SAAAC,MAAA,IAAAC,OAAA;AAmBA,eAAe,SAASC,UAAUA,CAAC;EAAEC;AAAS,CAAC,EAAE;EAAAC,EAAA;EAE7C,MAAM,CAACC,SAAS,EAAEC,YAAY,CAAC,GAAGP,QAAQ,CAAC,IAAI,CAAC;EAChD,MAAM,CAACQ,UAAU,EAAEC,aAAa,CAAC,GAAGT,QAAQ,CAAC,KAAK,CAAC;EAGnD,MAAM,CAACU,KAAK,EAAEC,QAAQ,CAAC,GAAGX,QAAQ,CAAC,EAAE,CAAC;EACtC,MAAM,CAACY,IAAI,EAAEC,OAAO,CAAC,GAAGb,QAAQ,CAAC,EAAE,CAAC;EAEpCD,SAAS,CAAC,MAAM;IAEZ,MAAMe,EAAE,GAAG,IAAIC,eAAe,CAAC,CAAC;IAEhC,MAAMC,SAAS,GAAG,MAAAA,CAAA,KAAY;MAC1B,IAAI;QACA,MAAMC,GAAG,GAAG,MAAMC,KAAK,CAAC,uCAAuC,EAAE;UAC7DC,MAAM,EAAE,KAAK;UACbC,WAAW,EAAE,SAAS;UACtBC,MAAM,EAAEP,EAAE,CAACO;QACf,CAAC,CAAC;QAEF,IAAIJ,GAAG,CAACK,EAAE,EAAE;UACR,MAAMC,IAAI,GAAG,MAAMN,GAAG,CAACO,IAAI,CAAC,CAAC;UAC7B;UACAb,QAAQ,CAACY,IAAI,CAACb,KAAK,IAAI,EAAE,CAAC;UAC1BG,OAAO,CAACU,IAAI,CAACX,IAAI,IAAI,EAAE,CAAC;UACxBH,aAAa,CAAC,IAAI,CAAC;QACvB,CAAC,MAAM;UACHA,aAAa,CAAC,KAAK,CAAC;QACxB;MACJ,CAAC,CAAC,MAAM;QAEJA,aAAa,CAAC,KAAK,CAAC;MACxB,CAAC,SAAS;QACNF,YAAY,CAAC,KAAK,CAAC;MACvB;IACJ,CAAC;IAEDS,SAAS,CAAC,CAAC;IACX,OAAO,MAAMF,EAAE,CAACW,KAAK,CAAC,CAAC;EAC3B,CAAC,EAAE,EAAE,CAAC;EAGN,IAAInB,SAAS,EAAE;IACX,oBAAOJ,OAAA;MAAG,aAAU,QAAQ;MAAAE,QAAA,EAAC;IAAiC;MAAAsB,QAAA,EAAAC,YAAA;MAAAC,UAAA;MAAAC,YAAA;IAAA,OAAG,CAAC;EACtE;;EAEA;EACA;EACA,MAAMC,SAAS,GAAG,CAAC,MAAM;IACrB,IAAI;MACA,OAAOC,IAAI,CAACC,KAAK,CAACC,YAAY,CAACC,OAAO,CAAC,UAAU,CAAC,IAAI,IAAI,CAAC;IAC/D,CAAC,CAAC,MAAM;MACJ,OAAO,CAAC,CAAC;IACb;EACJ,CAAC,EAAE,CAAC;EAGJ,IAAI1B,UAAU,IAAIE,KAAK,EAAE;IACrB,oBAAOZ,KAAK,CAACqC,YAAY,CAAC/B,QAAQ,EAAE;MAAEM,KAAK;MAAEE;IAAK,CAAC,CAAC;EACxD;EAGA,IAAIkB,SAAS,aAATA,SAAS,eAATA,SAAS,CAAEpB,KAAK,EAAE;IAClB,oBAAOZ,KAAK,CAACqC,YAAY,CAAC/B,QAAQ,EAAE;MAChCM,KAAK,EAAEoB,SAAS,CAACpB,KAAK;MACtBE,IAAI,EAAEkB,SAAS,CAAClB;IACpB,CAAC,CAAC;EACN;EAGA,OAAO,IAAI;AACf;AAACP,EAAA,CAxEuBF,UAAU;AAAAiC,EAAA,GAAVjC,UAAU;AAAA,IAAAiC,EAAA;AAAAC,YAAA,CAAAD,EAAA","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}